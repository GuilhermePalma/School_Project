
name: 🚀 Deploy Site With FTP - Debug

on:
  # Executa quando ha Push ou Pull Request na Branch Develop
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]
    
  # Executa somente Manualmente
  workflow_dispatch:

# Tarefas à serem realizadas
jobs:
  web-deploy:
    # Configuração do Ambiente 
    # Referencia: https://github.com/gabrielfroes/github-actions-ftp
    name: 🎉 Deploy Site - Debug
    runs-on: [windows-latest]
    steps:
    
      # Obtem o Ultimo Commit
      - name: 🚚 Get Latest Code
        uses: actions/checkout@v2
      
      # Mudança na String Connection
      # XPath https://qastack.com.br/programming/4531995/getting-attribute-using-xpath
      - name: ✒️ Set-Up Production String Connection
        uses: rvolo/xml-replace-action@v0.2
        with:
          filepath: "SchoolProject/Web.config"
          xpath: "/*/configuration/connectionStrings/add/@connectionString"
          replace: ${{ secrets.CONNECTION_DATABASE }}
      
      # Deploy com FTP
      - name: 📂 Deploy FTP Files
        uses: SamKirkland/FTP-Deploy-Action@4.0.0
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_KEY }}
          server-dir: public_html/schoolproject_debug/
          
